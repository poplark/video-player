!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VideoPlayer=t():e.VideoPlayer=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,s=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function p(e,t,r,n){var i,s,o,a;if(u(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=h(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,a=l,console&&console.warn&&console.warn(a)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=c.bind(n);return i.listener=r,n.wrapFn=i,i}function m(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):f(i,i.length)}function y(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)s(l,this,t);else{var u=l.length,h=f(l,u);for(r=0;r<u;++r)s(h[r],this,t)}return!0},a.prototype.addListener=function(e,t){return p(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return p(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,d(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,s,o;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return m(this,e,!0)},a.prototype.rawListeners=function(e){return m(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):y.call(e,t)},a.prototype.listenerCount=y,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){"use strict";r.r(t),r.d(t,"MultiplePlayer",(function(){return h})),r.d(t,"MultiplePlayerComponent",(function(){return p}));var n,i,s=r(0);!function(e){e[e.init=0]="init",e[e.loading=1]="loading",e[e.ready=2]="ready"}(n||(n={}));class o extends s.EventEmitter{constructor(e){super(),this.state=n.init,this._duration=0,this.uri=e,this.videoElem=document.createElement("video"),this.init()}get duration(){return this._duration}set duration(e){this._duration=e,this.state!==n.ready&&(this.state=n.ready,this.emit("ready"))}init(){this.state=n.loading,this.videoElem.preload="auto",this.videoElem.onloadedmetadata=()=>{this.duration=this.videoElem.duration},this.videoElem.src=this.uri}}function a(e){return Object.prototype.toString.call(e)}function l(e){return"[object Number]"===a(e)}function u(e){return 0===e.indexOf("#")?e.slice(1):e}!function(e){e[e.playing=0]="playing",e[e.paused=1]="paused"}(i||(i={}));class h extends s.EventEmitter{constructor(e){super(),this.sources=[],this.baseTime=0,this._currentTime=0,this._duration=0,this._state=i.paused,this.onPlay=()=>{console.log("play ",this.playerElem.currentTime),this.emit("play",this.currentSource),this._state=i.playing},this.onPause=()=>{console.log("pause ",this.playerElem.currentTime),this.emit("pause",this.currentSource),this._state=i.paused},this.onTimeUpdate=()=>{this._currentTime=this.baseTime+this.playerElem.currentTime,this.emit("currentTime",this.currentTime)},this.onEnded=()=>{var e;console.log("ended ",this.playerElem.currentTime),this.currentSource&&this.play(this.baseTime+(null===(e=this.currentSource)||void 0===e?void 0:e.duration))},this.playerElem=e}get currentTime(){return this._currentTime}get duration(){return this._duration}set duration(e){this._duration=e,this.emit("duration-changed",this._duration)}get state(){return this._state}load(){this.playerElem.addEventListener("play",this.onPlay),this.playerElem.addEventListener("timeupdate",this.onTimeUpdate),this.playerElem.addEventListener("ended",this.onEnded),this.playerElem.addEventListener("pause",this.onPause)}unload(){this.playerElem.removeEventListener("play",this.onPlay),this.playerElem.removeEventListener("timeupdate",this.onTimeUpdate),this.playerElem.removeEventListener("ended",this.onEnded),this.playerElem.removeEventListener("pause",this.onPause),this.playerElem.currentTime=0}addSource(e){const t=new o(e);t.on("ready",()=>{this.duration+=t.duration}),this.sources.push(t)}removeSource(){}playSource(e){this.currentSource&&this.unload(),this.currentSource=e,this.playerElem.replaceWith(e.videoElem),this.playerElem=e.videoElem,this.load()}play(e){let t,r=0;if(l(e)){const n=this.sources.findIndex(t=>{let n=r+t.duration;return e<n||(r=n,!1)});n>=0?t=this.sources[n]:(r=0,e=0,t=this.sources[0])}else e=0,t=this.sources[0];return this.baseTime=r,this._currentTime=e,this.currentSource!==t&&this.playSource(t),this.playerElem.currentTime=this.currentTime-this.baseTime,this.playerElem.play()}pause(){this.playerElem.pause()}}class p{constructor(e){if(this.playBtnElem=document.createElement("div"),this.progressBarElem=document.createElement("div"),this.changeCurrentTime=e=>{if(!(l(e)&&e>=0))throw new TypeError("The time supplied is not valid");this.player.play(e)},this.renderCurrentTime=()=>{},"[object String]"===a(e)){const t=document.querySelector("#"+u(e));if(!t){let t=new Error(`not found element by id ${e}`);throw t.name="NotFound",t}this.containerElem=t}else{if(!(e instanceof Element))throw new TypeError("The element or ID supplied is not valid");this.containerElem=e}this.playerElem=document.createElement("video"),this.playerElem.preload="auto",this.playerElem.id=`m-player-${u(e)}`,this.containerElem.appendChild(this.playerElem),this.player=new h(this.playerElem),this.initPlayBtn(),this.initProgressBar(),this.initListener()}initListener(){this.player.on("play",e=>{console.log("play ",e),this.playBtnElem.innerText="pause"}),this.player.on("currentTime",e=>{console.log(`currentTime ${e}`),this.progressBarElem.innerText=`${this.player.currentTime}/${this.player.duration}`}),this.player.on("duration-changed",e=>{console.log(`duration ${e}`),this.progressBarElem.innerText=`${this.player.currentTime}/${this.player.duration}`}),this.player.on("pause",e=>{console.log("pause ",e),this.playBtnElem.innerText="play"})}initPlayBtn(){let e=document.createElement("div");e.innerText="play",e.addEventListener("click",()=>{switch(this.player.state){case i.playing:this.pause();break;case i.paused:this.play(this.player.currentTime)}}),this.playBtnElem=e,this.containerElem.appendChild(this.playBtnElem)}initProgressBar(){let e=document.createElement("div");e.innerText=`${this.player.currentTime}/${this.player.duration}`,this.progressBarElem=e,this.containerElem.appendChild(this.progressBarElem)}play(e){this.player.play(e).catch(e=>{alert(`play error ${e}`)})}pause(){this.player.pause()}addSource(e){this.player.addSource(e)}}}])}));